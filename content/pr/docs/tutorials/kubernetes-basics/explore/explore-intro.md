---
title: مشاهده Pods و گره‌ها
weight: 10
---

## {{% heading "objectives" %}}

* درباره Kubernetes Pods اطلاعات کسب کنید.
* با Nodes Kubernetes آشنا شوید.
* عیب یابی برنامه های مستقر شده.

## Kubernetes Pods

{{% alert %}}
_یک  Pod گروهی از یک یا چند کانتینر برنامه (مانند داکر) است و شامل فضای ذخیره‌سازی مشترک (volumes)، آدرس IP و اطلاعاتی در مورد نحوه اجرای آنها می‌شود.
._
{{% /alert %}}


وقتی در [Module 2](/docs/tutorials/kubernetes-basics/deploy-app/deploy-intro/) یک Deployment ایجاد کردید، Kubernetes یک **Pod** برای میزبانی instance برنامه شما ایجاد کرد. یک Pod یک انتزاع Kubernetes است که گروهی از یک یا چند کانتینر برنامه (مانند Docker) و برخی منابع مشترک برای آن کانتینرها را نشان می‌دهد. این منابع عبارتند از:

* فضای ذخیره‌سازی مشترک، به عنوان Volumeها
* شبکه، به عنوان یک   cluster IP address منحصر به فرد
* اطلاعات مربوط به نحوه اجرای هر کانتینر، مانند نسخه image container
یا پورت‌های خاص برای استفاده


یک Pod یک "میزبان منطقی" مختص برنامه را مدل‌سازی می‌کند و می‌تواند شامل کانتینرهای برنامه مختلفی باشد که نسبتاً به هم متصل هستند. به عنوان مثال، یک Pod ممکن است شامل کانتینری با برنامه Node.js شما و همچنین کانتینر دیگری باشد که داده‌هایی را که قرار است توسط وب سرور Node.js منتشر شود، تغذیه می‌کند. کانتینرهای موجود در یک Pod یک آدرس IP و فضای پورت را به اشتراک می‌گذارند، همیشه در یک مکان و زمان‌بندی مشترک قرار دارند و در یک زمینه مشترک در همان Node اجرا می‌شوند.


پادها (Pods) واحدهای اتمی در پلتفرم Kubernetes هستند. وقتی ما یک Deployment در Kubernetes ایجاد می‌کنیم، آن Deployment پادهایی را با کانتینرهایی درون آنها ایجاد می‌کند (برخلاف ایجاد مستقیم کانتینرها). هر پاد به Node که در آن برنامه‌ریزی شده است، متصل است و تا زمان خاتمه (طبق restart policy) یا حذف، در آنجا باقی می‌ماند. در صورت خرابی یک Node پادهای مشابه روی سایر گره‌های موجود در Node برنامه‌ریزی می‌شوند.


### Pods نمای کلی

{{< figure src="/docs/tutorials/kubernetes-basics/public/images/module_03_pods.svg" class="diagram-medium" >}}

{{% alert %}}
_کانتینرها فقط در صورتی باید با هم در یک Pod زمان‌بندی شوند که به شدت به هم وابسته باشند و نیاز به اشتراک منابعی مانند دیسک داشته باشند.._
{{% /alert %}}

## Nodes

یک پاد همیشه روی یک **Node** اجرا می‌شود. یک گره یک ماشین worker در Kubernetes است و بسته به کلاستر، می‌تواند یک ماشین مجازی یا فیزیکی باشد. هر Node توسط control plane مدیریت می‌شود. یک گره می‌تواند چندین پاد داشته باشد و control plane  Kubernetes به طور خودکار زمان‌بندی پادها را در بین Node موجود در کلاستر مدیریت می‌کند. زمان‌بندی خودکار control plane ، منابع موجود در هر Node را در نظر می‌گیرد.

هر Node Kubernetes حداقل موارد زیر را اجرا می‌کند:

* Kubelet، فرآیندی که مسئول ارتباط بین   Kubernetes control و Node است؛ این فرآیند، Podها و کانتینرهای در حال اجرا روی یک دستگاه را مدیریت می‌کند.
plane وNode؛ Podها و کانتینرهای در حال اجرا روی یک دستگاه را مدیریت می‌کند.

* یک container runtime (مانند داکر) که مسئول دریافت container image از رجیستری، باز کردن کانتینر و اجرای برنامه است.


### Nodes بررسی

{{< figure src="/docs/tutorials/kubernetes-basics/public/images/module_03_nodes.svg" class="diagram-medium" >}}

## عیب‌یابی با kubectl


در [Module 2](/docs/tutorials/kubernetes-basics/deploy-app/deploy-intro/)، شما از رابط خط فرمان kubectl استفاده کردید. در Module ۳ نیز برای دریافت اطلاعات در مورد برنامه‌های مستقر شده و محیط‌های آنها، از آن استفاده خواهید کرد. رایج‌ترین عملیات را می‌توان با زیرفرمان‌های kubectl زیر انجام داد:

* `kubectl get` - فهرست منابع
* `kubectl describe` - نمایش اطلاعات دقیق در مورد یک منبع
* `kubectl logs`  - چاپ گزارش‌ها از یک کانتینر در یک پاد
* `kubectl exec` -اجرای یک دستور روی یک کانتینر در یک پاد

شما می‌توانید از این دستورات برای مشاهده زمان استقرار برنامه‌ها، وضعیت فعلی آنها، محل اجرا و پیکربندی‌های آنها استفاده کنید.

حالا که اطلاعات بیشتری در مورد اجزای کلاستر و خط فرمان خود داریم، بیایید برنامه خود را بررسی کنیم.

### تنظیمات برنامه را بررسی کنید

بیایید بررسی کنیم که آیا برنامه‌ای که در سناریوی قبلی مستقر کردیم، در حال اجرا است یا خیر. ما از دستور `kubectl get` استفاده می‌کنیم و به دنبال Pod های موجود خواهیم گشت:

```shell
kubectl get pods
```


اگر هیچ پادی در حال اجرا نیست، لطفاً چند ثانیه صبر کنید و دوباره پادها را فهرست کنید.

به محض اینکه یک پاد در حال اجرا را مشاهده کردید، می‌توانید ادامه دهید.

در مرحله بعد، برای مشاهده اینکه چه کانتینرهایی درون آن پاد هستند و از چه images برای ساخت آن کانتینرها استفاده شده است، دستور `kubectl describe pods` را اجرا می‌کنیم:

```shell
kubectl describe pods
```


در اینجا جزئیاتی در مورد کانتینر Pod مشاهده می‌کنیم: آدرس IP، پورت‌های مورد استفاده و فهرستی از رویدادهای مربوط به چرخه عمر Pod.

خروجی زیردستور `describe` گسترده است و برخی از مفاهیمی را که هنوز توضیح نداده‌ایم، پوشش می‌دهد، اما نگران نباشید، تا پایان این آموزش با آنها آشنا خواهید شد.


{{< note >}}
زیردستور `describe` می‌تواند برای دریافت اطلاعات دقیق در مورد اکثر اجزای اولیه Kubernetes، از جمله Nodeها، Podها و Deployments، مورد استفاده قرار گیرد. خروجی describe طوری طراحی شده است که برای انسان قابل خواندن باشد، نه اینکه بتوان روی آن اسکریپت نوشت.
{{< /note >}}

### نمایش برنامه در ترمینال

به یاد داشته باشید که پادها در یک شبکه خصوصی و ایزوله اجرا می‌شوند - بنابراین ما باید به آنها دسترسی پروکسی داشته باشیم تا بتوانیم آنها را اشکال‌زدایی و با آنها تعامل داشته باشیم. برای انجام این کار، از دستور `kubectl proxy` برای اجرای یک پروکسی در **second terminal** استفاده خواهیم کرد. یک پنجره ترمینال جدید باز کنید و در آن ترمینال جدید، دستور زیر را اجرا کنید:

```shell
kubectl proxy
```

حالا دوباره، نام پاد را دریافت می‌کنیم و آن پاد را مستقیماً از طریق پروکسی جستجو می‌کنیم.
برای دریافت نام پاد و ذخیره آن در environment variable`POD_NAME`:

```shell
export POD_NAME="$(kubectl get pods -o go-template --template '{{range .items}}{{.metadata.name}}{{"\n"}}{{end}}')"
echo Name of the Pod: $POD_NAME
```

برای دیدن خروجی برنامه، یک درخواست `curl` اجرا کنید:

```shell
curl http://localhost:8001/api/v1/namespaces/default/pods/$POD_NAME:8080/proxy/
```

URL مسیر دسترسی به API مربوط به Pod است.

{{< note >}}
نیازی به مشخص کردن نام کانتینر نداریم، زیرا فقط یک کانتینر درون pod داریم
{{< /note >}}

### اجرای دستورات روی کانتینر

می‌توانیم پس از راه‌اندازی و اجرای پاد، دستورات را مستقیماً روی کانتینر اجرا کنیم.

برای این کار، از زیردستور `exec` استفاده می‌کنیم و نام پاد را به عنوان پارامتر وارد می‌کنیم.

بیاییدenvironment variables را فهرست کنیم:

```shell
kubectl exec "$POD_NAME" -- env
```


باز هم، شایان ذکر است که نام خود کانتینر را می‌توان حذف کرد

زیرا ما فقط یک کانتینر در Pod داریم.

در مرحله بعد، بیایید یک ه bash session را در کانتینر Pod شروع کنیم:

```shell
kubectl exec -ti $POD_NAME -- bash
```

اکنون یک کنسول باز روی کانتینر داریم که برنامه NodeJS خود را در آن اجرا می‌کنیم. کد منبع برنامه در فایل `server.js` قرار دارد:

```shell
cat server.js
```

با اجرای دستور curl می‌توانید بررسی کنید که برنامه در حال اجرا است:

```shell
curl http://localhost:8080
```

{{< note >}}
در اینجا ما از `localhost` استفاده کردیم زیرا دستور را درون NodeJS Pod اجرا کردیم.

اگر نمی‌توانید به `localhost:8080` متصل شوید، بررسی کنید که دستور `kubectl exec` را اجرا کرده‌اید و دستور را از درون Pod اجرا می‌کنید.
{{< /note >}}

برای بستن اتصال کانتینر، دستور `exit` را تایپ کنید.

## {{% heading "whatsnext" %}}

* آموزش
[Using A Service To Expose Your App](/docs/tutorials/kubernetes-basics/expose/expose-intro/).
* بیشتر بدانید [Pods](/docs/concepts/workloads/pods/).
* بیشتر بدانید [Nodes](/docs/concepts/architecture/nodes/).
